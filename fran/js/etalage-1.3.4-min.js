!function(a){a.fn.etalage=function(b){var c=a.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",show_begin_end_smallthumb:!0,magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,show_lens:!0,icon_offset:20,hide_cursor:!1,show_hint:!0,hint_offset:15,speed:400,autoplay:!0,autoplay_interval:6e3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},b);return a.each(this,function(){function Ra(a){r=r?r-1:0,q=!0;var e,f,g,h,c=b.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),d=b.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"left"===a?(e=c.prev().addClass("etalage_smallthumb_first"),f=d.prev().addClass("etalage_smallthumb_last"),g=c):(e=c.next().addClass("etalage_smallthumb_first"),f=d.next().addClass("etalage_smallthumb_last"),g=d),r?"left"===a?e.trigger("click"):f.trigger("click"):(h="vert"===A?e.position().top:e.position().left,Ia(h,e,f,g))}function Sa(a){q=!0;var e,f,g;b.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),b.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"end"===a?(e=S.eq(U-V).addClass("etalage_smallthumb_first"),f=S.eq(U-1).addClass("etalage_smallthumb_last"),g=f,f.hasClass("etalage_smallthumb_navtostart")&&(g=f.prev())):(e=S.eq(0).addClass("etalage_smallthumb_first"),f=S.eq(V-1).addClass("etalage_smallthumb_last"),g=e,e.hasClass("etalage_smallthumb_navtoend")&&(g=e.next()));var h="vert"===A?e.position().top:e.position().left;Ia(h,e,f,g)}function Ta(){Sa("start")}function Ua(){Sa("end")}var b=a(this);if(b.is("ul")&&b.children("li").length&&b.find("img.etalage_source_image").length){var d,e,f,g,h,i,j,k,l,m,n=b.attr("id"),o=Math.floor(.7*c.speed),p=Math.round(c.speed/100),q=!1,r=0,s=!1,t=!0,u=!1,v=0,w=0,x=0,y=0,z=0,A="hori";"undefined"!=typeof n&&n||(n="[no id]"),"left"!==c.smallthumbs_position&&"right"!==c.smallthumbs_position||(A="vert"),"object"==typeof a.browser&&a.browser.msie&&a.browser.version<9&&(t=!1,a.browser.version<7&&(s=!0)),b.addClass("etalage").show();var B=b.children("li").addClass("etalage_thumb");B.first().show().addClass("etalage_thumb_active");var C=B.length,D=c.autoplay;C<2&&(D=!1),"right"===c.align&&b.addClass("etalage_right"),a.each(B,function(b){b+=1;var c=a(this),d=c.find(".etalage_thumb_image").removeAttr("alt").show(),e=c.find(".etalage_source_image"),f=c.find("a");c.data("id",b).addClass("thumb_"+b),!d.length&&e.length?c.prepend('<img class="etalage_thumb_image" style="display: none;" src="'+e.attr("src")+'" />'):d.length||e.length||c.remove(),f.length&&c.find(".etalage_thumb_image").data("anchor",f.attr("href"))});var E=B.find(".etalage_thumb_image").show();a.each(E,function(){a(this).data("src",this.src)});var F=a('<li class="etalage_magnifier'+(c.show_lens?"":" hidden")+'"><div><img /></div></li>').appendTo(b),G=F.children("div"),H=G.children("img"),I=a('<li class="etalage_icon">&nbsp;</li>').appendTo(b);c.show_icon&&I.show();var J;c.show_hint&&(J=a('<li class="etalage_hint">&nbsp;</li>').appendTo(b).show());var K,L=c.zoom_element;"auto"!==L&&L&&a(L).length?K=a(L).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(L="auto",K=a('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(b));var N,M=K.children("div");t&&(N=a('<img class="etalage_zoom_preview" />').css({width:c.source_image_width,height:c.source_image_height,opacity:.3}).prependTo(M).show());var P,O=M.children(".etalage_zoom_img").css({width:c.source_image_width,height:c.source_image_height});c.show_descriptions&&(P=a('<div class="etalage_description'+(c.right_to_left?" rtl":"")+'"></div>').prependTo(K));var Q,R,S,T,U,V=c.small_thumbs;(C>1||!c.smallthumb_hide_single)&&(Q=a('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(b),R=Q.children("ul"),a.each(E,function(){var b=a(this);f=b.data("src"),g=b.parents(".etalage_thumb").data("id");var c=a('<img class="etalage_small_thumb" src="'+f+'"/>').attr("onerror",b.attr("onerror")).attr("data-path",b.data("path")).attr("data-subpath",b.data("subpath")).attr("data-file",b.data("file")).attr("data-width",b.data("width")).attr("data-height",b.data("height"));c.appendTo(a("<li"+(b.parent().hasClass("video")?" class='video'":"")+"></li>").data("thumb_id",g).appendTo(R))}),S=R.children("li").css({opacity:c.smallthumb_inactive_opacity}),V<2&&(V=2),C>V?(c.show_begin_end_smallthumb?(f=E.eq(C-1).data("src"),g=B.eq(C-1).data("id"),a('<li class="etalage_smallthumb_first etalage_smallthumb_navtoend"><img class="etalage_small_thumb" src="'+f+'" /></li>').data("src",f).data("thumb_id",g).css({opacity:c.smallthumb_inactive_opacity}).prependTo(R),f=E.eq(0).data("src"),g=B.eq(0).data("id"),a('<li class="etalage_smallthumb_navtostart"><img class="etalage_small_thumb" src="'+f+'" /></li>').data("src",f).data("thumb_id",g).css({opacity:c.smallthumb_inactive_opacity}).appendTo(R),S=R.children("li"),S.eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):S.eq(0).addClass("etalage_smallthumb_first etalage_smallthumb_active").css({opacity:1}),S.eq(V-1).addClass("etalage_smallthumb_last")):S.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),a.each(S,function(b){a(this).data("id",b+1)}),T=S.children("img"),U=S.length,"vert"===A&&S.addClass("vertical")),h=c.magnifier_invert?1:c.magnifier_opacity;var W=parseInt(B.css("borderLeftWidth"),10)+parseInt(B.css("borderRightWidth"),10)+parseInt(E.css("borderLeftWidth"),10)+parseInt(E.css("borderRightWidth"),10),X=parseInt(B.css("marginLeft"),10)+parseInt(B.css("marginRight"),10),Y=parseInt(B.css("paddingLeft"),10)+parseInt(B.css("paddingRight"),10)+parseInt(E.css("marginLeft"),10)+parseInt(E.css("marginRight"),10)+parseInt(E.css("paddingLeft"),10)+parseInt(E.css("paddingRight"),10),Z=c.thumb_image_width+W+X+Y,$=c.thumb_image_height+W+X+Y,_=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0;(C>1||!c.smallthumb_hide_single)&&(_=parseInt(S.css("borderLeftWidth"),10)+parseInt(S.css("borderRightWidth"),10)+parseInt(T.css("borderLeftWidth"),10)+parseInt(T.css("borderRightWidth"),10),aa=parseInt(S.css("marginTop"),10),ba=parseInt(S.css("paddingLeft"),10)+parseInt(S.css("paddingRight"),10)+parseInt(T.css("marginLeft"),10)+parseInt(T.css("marginRight"),10)+parseInt(T.css("paddingLeft"),10)+parseInt(T.css("paddingRight"),10),"vert"===A?(da=Math.round(($-(V-1)*aa)/V)-(_+ba),ca=Math.round(c.thumb_image_width*da/c.thumb_image_height),ea=ca+_+ba,fa=da+_+ba):(ca=Math.round((Z-(V-1)*aa)/V)-(_+ba),da=Math.round(c.thumb_image_height*ca/c.thumb_image_width),ea=ca+_+ba,fa=da+_+ba));var ja,ka,ga=parseInt(K.css("borderTopWidth"),10),ha=parseInt(c.zoom_area_distance,10),ia=parseInt(K.css("paddingTop"),10);ja=c.zoom_area_width-2*ga-2*ia>c.source_image_width?c.source_image_width:c.zoom_area_width-2*ga-2*ia,ka="justify"===c.zoom_area_height?$+aa+fa-2*ga-2*ia:c.zoom_area_height-2*ga-2*ia,ka>c.source_image_height&&(ka=c.source_image_height);var la,ma,na,oa;c.show_descriptions&&(la=parseInt(P.css("borderLeftWidth"),10)+parseInt(P.css("borderRightWidth"),10),ma=parseInt(P.css("marginLeft"),10)+parseInt(P.css("marginRight"),10),na=parseInt(P.css("paddingLeft"),10)+parseInt(P.css("paddingRight"),10),oa=ja-la-ma-na);var pa;s&&(pa=a('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(K));var qa=parseInt(F.css("borderTopWidth"),10),ra=parseInt(B.css("borderTopWidth"),10)+parseInt(B.css("marginTop"),10)+parseInt(B.css("paddingTop"),10)+parseInt(E.css("borderTopWidth"),10)+parseInt(E.css("marginTop"),10)-qa,sa=E.offset().left-b.offset().left-qa;"left"===c.smallthumbs_position?sa=sa+ea+aa:"top"===c.smallthumbs_position&&(ra=ra+fa+aa);var za,Aa,ta=Math.round(ja*(c.thumb_image_width/c.source_image_width)),ua=Math.round(ka*(c.thumb_image_height/c.source_image_height)),va=ra+c.thumb_image_height-ua,wa=sa+c.thumb_image_width-ta,xa=Math.round(ta/2),ya=Math.round(ua/2);if(c.show_hint&&(za=parseInt(c.hint_offset,10)+parseInt(J.css("marginTop"),10),Aa=parseInt(c.hint_offset,10)+parseInt(J.css("marginRight"),10),"right"===c.smallthumbs_position&&(Aa=Aa-ea-aa)),"vert"===A?(k=Z+aa+ea,b.css({width:k,height:$})):(k=Z,b.css({width:k,height:$+aa+fa})),c.show_icon&&(m={top:$-I.outerHeight(!0)-parseInt(c.icon_offset,10),left:parseInt(c.icon_offset,10)},"left"===c.smallthumbs_position?m.left=ea+aa+parseInt(c.icon_offset,10):"top"===c.smallthumbs_position&&(m.top+=fa+aa),I.css(m)),c.show_hint&&J.css({margin:0,top:-za,right:-Aa}),H.css({margin:0,padding:0,width:c.thumb_image_width,height:c.thumb_image_height}),G.css({margin:0,padding:0,width:ta,height:ua}),m={margin:0,padding:0,left:(wa-sa)/2,top:(va-ra)/2},"left"===c.smallthumbs_position?m.left="+="+ea+aa:"top"===c.smallthumbs_position&&(m.top="+="+fa+aa),F.css(m).hide(),M.css({width:ja,height:ka}),m={margin:0,opacity:0},"right"===c.align&&"auto"===L?m.left=-(ja+2*ga+2*ia+ha):"auto"===L&&(m.left=k+ha),K.css(m).hide(),c.show_descriptions&&(m={width:oa,bottom:ia,left:ia,opacity:c.description_opacity},"top"===c.description_location&&(m.top=ia,m.bottom="auto"),P.css(m).hide()),C>1||!c.smallthumb_hide_single)if("vert"===A?(m={top:0,height:$},"left"===c.smallthumbs_position?B.css({left:ea+aa}):m.marginLeft=Z+aa,Q.css(m),R.css({height:fa*U+U*aa+100}),T.css({width:ca,height:da}).attr("height",da),S.css({margin:0,marginBottom:aa})):(m={width:Z},"top"===c.smallthumbs_position?B.css({top:fa+aa}):m.top=$+aa,Q.css(m),R.css({width:ea*U+U*aa+100}),T.css({width:ca,height:da}).attr("width",ca),S.css({margin:0,marginRight:aa})),l="vert"===A?fa*V+(V-1)*aa-$:ea*V+(V-1)*aa-Z,l>0)for(d=1;d<=U-1;d+=V-1)for(e=1;e<=l;e+=1)"vert"===A?S.eq(d+e-1).css({marginBottom:aa-1}):S.eq(d+e-1).css({marginRight:aa-1});else if(l<0)for(d=1;d<=U-1;d+=V-1)for(e=1;e<=-l;e+=1)"vert"===A?(S.eq(d+e-1).css({marginBottom:aa+1}),R.css({height:parseInt(R.css("height"),10)+1})):(S.eq(d+e-1).css({marginRight:aa+1}),R.css({width:parseInt(R.css("width"),10)+1}));c.show_icon&&!c.magnifier_invert&&F.css({background:F.css("background-color")+" "+I.css("background-image")+" center no-repeat"}),c.hide_cursor&&F.add(I).css({cursor:"none"}),s&&pa.css({width:M.css("width"),height:M.css("height")});var Ba=B.first().find(".etalage_thumb_image"),Ca=B.first().find(".etalage_source_image");c.magnifier_invert&&H.attr("src",Ba.data("src")).show(),t&&N.attr("src",Ba.data("src")),O.attr("src",Ca.attr("src")),c.show_descriptions&&(j=Ca.attr("title"),j&&P.html(j).show()),B.find("img.video_thumb").hide();var Da=function(){i&&(clearInterval(i),i=!1)},Ea=function(){i&&Da(),i=setInterval(function(){La()},c.autoplay_interval)},Fa=function(){Ba.parent().hasClass("video")||(c.show_lens?F.stop().fadeTo(o,h):F.stop().hide().find("img").hide(),I.stop().animate({opacity:0},o),K.stop().show().animate({opacity:1},o),c.magnifier_invert&&Ba.stop().animate({opacity:c.magnifier_opacity},o)),D&&Da()},Ga=function(){F.stop().fadeOut(c.speed),I.stop().animate({opacity:1},c.speed),K.stop().animate({opacity:0},c.speed,function(){a(this).hide()}),c.magnifier_invert&&Ba.stop().animate({opacity:1},c.speed,function(){c.click_to_zoom&&(u=!1)}),clearTimeout(v),D&&Ea()},Ha=function(d,e){var f,g,h=b.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");d.addClass("etalage_smallthumb_active"),F.stop().hide(),K.stop().hide(),e||(q=!0,h.stop(!0,!0).animate({opacity:c.smallthumb_inactive_opacity},o),d.stop(!0,!0).animate({opacity:1},o,function(){q=!1})),b.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},c.speed,function(){a(this).hide()}),f=B.filter(".thumb_"+d.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},c.speed),Ba=f.find(".etalage_thumb_image"),Ca=f.find(".etalage_source_image"),c.magnifier_invert&&H.attr("src",Ba.data("src")),t&&N.attr("src",Ba.data("src")),O.attr("src",Ca.attr("src")),c.show_descriptions&&(j=Ca.attr("title"),j?P.html(j).show():P.hide()),D&&(Da(),Ea()),g=d.data("id"),C>=V&&g--,Oa(g)},Ia=function(b,d,e,f){a.each(S,function(){var d=a(this),e={opacity:c.smallthumb_inactive_opacity};d.data("id")===f.data("id")&&(e.opacity=1),"vert"===A?e.top="-="+b:e.left="-="+b,d.animate(e,o,"swing",function(){q&&(f.addClass("etalage_smallthumb_active"),q=!1)})}),Ha(f,!0)},Ja=function(){var a=y-w,b=z-x,c=-a/p,d=-b/p;w-=c,x-=d,a<1&&a>-1&&(w=y),b<1&&b>-1&&(x=z),O.css({left:w,top:x}),t&&N.css({left:w,top:x}),(a>1||b>1||a<1||b<1)&&(v=setTimeout(function(){Ja()},25))},Ka=function(){var a;if(c.magnifier_invert&&b.find(".etalage_thumb_active").mouseleave(),c.right_to_left){if(a=b.find(".etalage_smallthumb_active").next(),!a.length)return C>V?Ta():S.first().trigger("click"),!0}else if(a=b.find(".etalage_smallthumb_active").prev(),!a.length)return C>V?Ua():S.last().trigger("click"),!0;a.trigger("click")},La=function(){var a;if(c.magnifier_invert&&b.find(".etalage_thumb_active").mouseleave(),c.right_to_left){if(a=b.find(".etalage_smallthumb_active").prev(),!a.length)return C>V?Ua():S.last().trigger("click"),!0}else if(a=b.find(".etalage_smallthumb_active").next(),!a.length)return C>V?Ta():S.first().trigger("click"),!0;a.trigger("click")},Ma=function(a){(C<=V||!c.show_begin_end_smallthumb)&&(a-=1);var d=S.eq(a);if(d.length&&!q){var g,e=b.find(".etalage_smallthumb_active"),f=e.data("id")-1;if(f>a){r=f-a;var h=b.find(".etalage_smallthumb_first"),i=h.data("id");a<i?(g=f-i,r-=g,h.trigger("click")):Ha(d,!1)}else if(f<a){r=a-f;var j=b.find(".etalage_smallthumb_last"),k=j.data("id")-1;a>=k?(g=k-f-1,r-=g,j.trigger("click")):Ha(d,!1)}}};window[n+"_previous"]=function(){Ka()},window[n+"_next"]=function(){La()},window[n+"_show"]=function(a){Ma(a)},window[n+"_stopAutoplay"]=function(){Da()};var Na=function(a,b){return!!c.click_callback(a,n,b)&&("function"!=typeof etalage_click_callback||(etalage_click_callback(a,n,b),!1))},Oa=function(a){c.change_callback(a,n)&&"function"==typeof etalage_change_callback&&etalage_change_callback(a,n)};B.add(F).add(I).mouseenter(function(){c.show_hint&&J.hide(),c.click_to_zoom&&!u||Fa()}).mouseleave(function(){Ga()});var Pa=-(c.source_image_width-ja),Qa=-(c.source_image_height-ka);B.add(F).add(I).mousemove(function(a){var b=Math.round(a.pageX-Ba.offset().left+sa),d=Math.round(a.pageY-Ba.offset().top+ra),e=b-xa,f=d-ya;if(e<sa&&(e=sa),e>wa&&(e=wa),f<ra&&(f=ra),f>va&&(f=va),F.css({left:e,top:f}),c.magnifier_invert){var g=e-sa,h=f-ra;H.css({left:-g,top:-h})}y=-((e-sa)*(1/(c.thumb_image_width/c.source_image_width))),z=-((f-ra)*(1/(c.thumb_image_height/c.source_image_height))),y<Pa&&(y=Pa),z<Qa&&(z=Qa),c.zoom_easing?(clearTimeout(v),Ja()):(t&&N.css({left:y,top:z}),O.css({left:y,top:z}))}),(C>1||!c.smallthumb_hide_single)&&(S.click(function(){var b=a(this);if(!b.hasClass("etalage_smallthumb_active")&&(!q||r))if(b.hasClass("etalage_smallthumb_first")&&b.prev().length)Ra("left");else if(b.hasClass("etalage_smallthumb_navtoend"))Ua();else if(b.hasClass("etalage_smallthumb_last")&&b.next().length)Ra("right");else if(b.hasClass("etalage_smallthumb_navtostart"))Ta();else{if(r&&!a(this).next().length)return Ua(),!0;if(r&&!a(this).prev().length)return Ta(),!0;Ha(b,!1)}}),c.smallthumb_select_on_hover&&S.mouseenter(function(){a(this).trigger("click")})),c.click_to_zoom?B.click(function(){u=!0,Fa()}):B.click(function(a){a.preventDefault();var b=Ba,c=Ba.data("anchor");c&&Na(c,b)&&(window.location=c)}),C>1&&c.keyboard&&a(document).keydown(function(a){39!==a.keyCode&&"39"!==a.keyCode||(c.right_to_left?Ka():La()),37!==a.keyCode&&"37"!==a.keyCode||(c.right_to_left?La():Ka())}),a(window).bind("load",function(){B.css({"background-image":"none"}),K.css({"background-image":"none"}),t&&(t=!1,N.remove())}),D&&Ea()}}),this}}(jQuery);